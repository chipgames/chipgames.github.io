/**
 * Í≤åÏûÑÏùò Ï†ÑÏó≠ Î≥ÄÏàòÏôÄ ÏÉÅÏàòÎ•º Í¥ÄÎ¶¨ÌïòÎäî ÌååÏùº
 * Î™®Îì† Í≤åÏûÑ Í¥ÄÎ†® Í∏∞Î≥∏ ÏÑ§Ï†ïÍ≥º ÏÉÅÌÉúÎ•º Ìè¨Ìï®
 */

// Ï∫îÎ≤ÑÏä§ Í¥ÄÎ†® Î≥ÄÏàò
// Í≤åÏûÑÏùò Î©îÏù∏ Î†åÎçîÎßÅ Ïª®ÌÖçÏä§Ìä∏Î•º Í¥ÄÎ¶¨
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Í≤åÏûÑ Í∏∞Î≥∏ ÏÉÅÏàò
// Í≤åÏûÑÏùò Í∏∞Î≥∏Ï†ÅÏù∏ ÏàòÏπòÏôÄ ÏÑ§Ï†ïÍ∞íÏùÑ Ï†ïÏùò
const TILE_SIZE = 40;                // ÌÉÄÏùºÏùò ÌÅ¨Í∏∞ (ÌîΩÏÖÄ)
const CRITICAL_CHANCE = 0.2;         // ÏπòÎ™ÖÌÉÄ Î∞úÏÉù ÌôïÎ•† (20%)
const CRITICAL_MULTIPLIER = 2;       // ÏπòÎ™ÖÌÉÄ Îç∞ÎØ∏ÏßÄ Î∞∞Ïú®
const GRID_WIDTH = canvas.width / TILE_SIZE;    // Í∑∏Î¶¨Îìú Í∞ÄÎ°ú ÌÉÄÏùº Ïàò
const GRID_HEIGHT = canvas.height / TILE_SIZE;  // Í∑∏Î¶¨Îìú ÏÑ∏Î°ú ÌÉÄÏùº Ïàò

// Í≤åÏûÑ ÏÉÅÌÉú Í¥ÄÎ†® Î≥ÄÏàò
// Í≤åÏûÑÏùò ÌòÑÏû¨ ÏÉÅÌÉúÏôÄ ÏßÑÌñâ ÏÉÅÌô©ÏùÑ Ï∂îÏ†Å
const gameState = {
    gold: 200,           // ÌòÑÏû¨ Î≥¥Ïú† Í≥®Îìú
    lives: 25,           // ÎÇ®ÏùÄ ÏÉùÎ™ÖÎ†•
    wave: 1,             // ÌòÑÏû¨ Ïõ®Ïù¥Î∏å
    isGameOver: false,   // Í≤åÏûÑ Ïò§Î≤Ñ ÏÉÅÌÉú
    waveInProgress: false, // Ïõ®Ïù¥Î∏å ÏßÑÌñâ Ï§ë Ïó¨Î∂Ä
    enemiesRemaining: 0,  // ÎÇ®ÏùÄ Ï†Å Ïàò
    isPaused: false,     // ÏùºÏãúÏ†ïÏßÄ ÏÉÅÌÉú
    isStarted: false,    // Í≤åÏûÑ ÏãúÏûë Ïó¨Î∂Ä
    score: 0,            // ÌòÑÏû¨ Ï†êÏàò
    difficulty: 'EASY',  // ÌòÑÏû¨ ÎÇúÏù¥ÎèÑ
    bossWave: 5,         // Î≥¥Ïä§ Îì±Ïû• Ïõ®Ïù¥Î∏å
    bossKilled: false,   // Î≥¥Ïä§ Ï≤òÏπò Ïó¨Î∂Ä
    goldMultiplier: 1,   // Í≥®Îìú ÌöçÎìù Î∞∞Ïú®
    maxTowers: 12,       // ÏµúÎåÄ ÌÉÄÏõå Ïàò
    towerCount: 0,       // ÌòÑÏû¨ ÏÑ§ÏπòÎêú ÌÉÄÏõå Ïàò
    experience: 0,       // ÌòÑÏû¨ Í≤ΩÌóòÏπò
    level: 1,            // ÌòÑÏû¨ Î†àÎ≤®
    experienceToNextLevel: 100, // Îã§Ïùå Î†àÎ≤®ÍπåÏßÄ ÌïÑÏöîÌïú Í≤ΩÌóòÏπò
    currentMap: 'STRAIGHT', // ÌòÑÏû¨ Îßµ
    currentWaveMessage: null, // ÌòÑÏû¨ Ïõ®Ïù¥Î∏å Î©îÏãúÏßÄ
    waveMessageStartTime: 0,  // Ïõ®Ïù¥Î∏å Î©îÏãúÏßÄ ÏãúÏûë ÏãúÍ∞Ñ
    lastSpawnTime: 0,    // ÎßàÏßÄÎßâ Ï†Å ÏÉùÏÑ± ÏãúÍ∞Ñ
    totalEnemies: 0,     // Ï¥ù Ï†Å Ïàò
    currentGroup: 1,     // ÌòÑÏû¨ Ï†Å Í∑∏Î£π
    totalGroups: 1,      // Ï¥ù Ï†Å Í∑∏Î£π Ïàò
    groupSize: 1,        // Í∑∏Î£πÎãπ Ï†Å Ïàò
    enemiesInCurrentGroup: 0 // ÌòÑÏû¨ Í∑∏Î£πÏùò ÎÇ®ÏùÄ Ï†Å Ïàò
};

// Í≤åÏûÑ ÌÜµÍ≥Ñ
// Í≤åÏûÑ ÏßÑÌñâ Ï§ëÏùò ÌÜµÍ≥Ñ Ï†ïÎ≥¥Î•º Ï†ÄÏû•
const gameStats = {
    enemiesKilled: 0,    // Ï≤òÏπòÌïú Ï†Å Ïàò
    bossesKilled: 0,     // Ï≤òÏπòÌïú Î≥¥Ïä§ Ïàò
    totalGold: 0,        // Ï¥ù ÌöçÎìù Í≥®Îìú
    highestWave: 0,      // ÏµúÍ≥† Ïõ®Ïù¥Î∏å
    eventsTriggered: [], // Î∞úÏÉùÌïú Ïù¥Î≤§Ìä∏ Î™©Î°ù
    playTime: 0,         // ÌîåÎ†àÏù¥ ÏãúÍ∞Ñ
    gamesPlayed: 0,      // ÌîåÎ†àÏù¥Ìïú Í≤åÏûÑ Ïàò
    gamesWon: 0,         // ÏäπÎ¶¨Ìïú Í≤åÏûÑ Ïàò
    gamesLost: 0         // Ìå®Î∞∞Ìïú Í≤åÏûÑ Ïàò
};

// Í≤åÏûÑ Í∞ùÏ≤¥ Í¥ÄÎ†® Î≥ÄÏàò
// Í≤åÏûÑ ÎÇ¥ ÎèôÏ†Å Í∞ùÏ≤¥Îì§ÏùÑ Í¥ÄÎ¶¨
let towers = [];         // ÏÑ§ÏπòÎêú ÌÉÄÏõå Î∞∞Ïó¥
let enemies = [];        // ÏÉùÏÑ±Îêú Ï†Å Î∞∞Ïó¥
let enemyGroups = [];    // Ï†Å Í∑∏Î£π Î∞∞Ïó¥
let groupIdCounter = 1;  // Í∑∏Î£π ID Ïπ¥Ïö¥ÌÑ∞
let rangePreview = null; // ÌÉÄÏõå Î≤îÏúÑ ÎØ∏Î¶¨Î≥¥Í∏∞ (Í∏∞Ï°¥ DOM Î∞©Ïãù, ÎØ∏ÏÇ¨Ïö©)
let towerPreview = null; // ÌÉÄÏõå ÎØ∏Î¶¨Î≥¥Í∏∞ Ï†ïÎ≥¥ { x, y, range, type }
let shownCombos = [];    // ÌëúÏãúÎêú ÌÉÄÏõå Ï°∞Ìï©
let currentWaveMessage = null; // ÌòÑÏû¨ Ïõ®Ïù¥Î∏å Î©îÏãúÏßÄ
let waveMessageStartTime = 0;  // Ïõ®Ïù¥Î∏å Î©îÏãúÏßÄ ÏãúÏûë ÏãúÍ∞Ñ
let lowSpecMode = false; // Ï†ÄÏÇ¨Ïñë Î™®Îìú ÏÉÅÌÉú
let damageEffects = []; // Îç∞ÎØ∏ÏßÄ Ïù¥ÌéôÌä∏ Ï†ïÎ≥¥ Î∞∞Ïó¥ (canvas ÏßÅÏ†ë Í∑∏Î¶¨Í∏∞Ïö©)
let skillEffects = []; // Ï†Å Ïä§ÌÇ¨ Ïù¥ÌéôÌä∏ Ï†ïÎ≥¥ Î∞∞Ïó¥ (canvas ÏßÅÏ†ë Í∑∏Î¶¨Í∏∞Ïö©)
let specialEffects = []; // ÌäπÏàò Ïù¥ÌéôÌä∏ Ï†ïÎ≥¥ Î∞∞Ïó¥ (canvas ÏßÅÏ†ë Í∑∏Î¶¨Í∏∞Ïö©)
let countdownActive = false;      // Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ ÏßÑÌñâ Ï§ë Ïó¨Î∂Ä
let countdownStartTime = 0;       // Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ ÏãúÏûë ÏãúÍ∞Å
let countdownDuration = 3000;     // Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ Ï†ÑÏ≤¥ ÏãúÍ∞Ñ(ms)

// UI ÏöîÏÜå
// Í≤åÏûÑÏùò UI ÏöîÏÜå Ï∞∏Ï°∞
const mapSelect = document.getElementById('mapSelect'); // Îßµ ÏÑ†ÌÉù ÎìúÎ°≠Îã§Ïö¥
const startBtn = document.getElementById('startBtn');   // Í≤åÏûÑ ÏãúÏûë Î≤ÑÌäº

// Í≤åÏûÑ ÏÑ§Ï†ï
// Í≤åÏûÑÏùò Îã§ÏñëÌïú ÏÑ§Ï†ïÍ∞íÎì§ÏùÑ Ï†ïÏùò

// Ï†Å Î†àÎ≤® ÏÑ§Ï†ï
const ENEMY_LEVEL_SETTINGS = {
    maxLevel: 999,               // ÏµúÎåÄ Î†àÎ≤®
    healthMultiplier: 1.2,       // Î†àÎ≤®Îãπ Ï≤¥Î†• Ï¶ùÍ∞ÄÏú®
    speedMultiplier: 1.05,       // Î†àÎ≤®Îãπ ÏÜçÎèÑ Ï¶ùÍ∞ÄÏú®
    rewardMultiplier: 1.15,      // Î†àÎ≤®Îãπ Î≥¥ÏÉÅ Ï¶ùÍ∞ÄÏú®
    experienceMultiplier: 1.1,   // Î†àÎ≤®Îãπ Í≤ΩÌóòÏπò Ï¶ùÍ∞ÄÏú®
    levelUpChance: 0.1,          // Î†àÎ≤®ÏóÖ ÌôïÎ•†
    maxLevelUpPerWave: 2         // Ïõ®Ïù¥Î∏åÎãπ ÏµúÎåÄ Î†àÎ≤®ÏóÖ ÌöüÏàò
};

// ÎÇúÏù¥ÎèÑ ÏÑ§Ï†ï
const DIFFICULTY_SETTINGS = {
    EASY: {
        gold: 200,           // Ï¥àÍ∏∞ Í≥®Îìú
        lives: 25,           // Ï¥àÍ∏∞ ÏÉùÎ™ÖÎ†•
        enemyHealth: 0.8,    // Ï†Å Ï≤¥Î†• Î∞∞Ïú®
        enemySpeed: 0.8,     // Ï†Å ÏÜçÎèÑ Î∞∞Ïú®
        goldReward: 0.9,     // Í≥®Îìú Î≥¥ÏÉÅ Î∞∞Ïú® (1.2 ‚Üí 0.9)
        maxTowers: 12,       // ÏµúÎåÄ ÌÉÄÏõå Ïàò
        enemySpawnRate: 0.03,// Ï†Å ÏÉùÏÑ± ÏÜçÎèÑ
        initialGold: 200,    // ÏãúÏûë Í≥®Îìú
        initialLives: 25     // ÏãúÏûë ÏÉùÎ™ÖÎ†•
    },
    NORMAL: {
        gold: 150,
        lives: 20,
        enemyHealth: 1,
        enemySpeed: 1,
        goldReward: 0.7,     // Í≥®Îìú Î≥¥ÏÉÅ Î∞∞Ïú® (1.0 ‚Üí 0.7)
        maxTowers: 10,
        enemySpawnRate: 0.05,
        initialGold: 150,
        initialLives: 20
    },
    HARD: {
        gold: 100,
        lives: 15,
        enemyHealth: 1.3,
        enemySpeed: 1.2,
        goldReward: 0.5,     // Í≥®Îìú Î≥¥ÏÉÅ Î∞∞Ïú® (0.8 ‚Üí 0.5)
        maxTowers: 8,
        enemySpawnRate: 0.07,
        initialGold: 100,
        initialLives: 15
    }
};

// Îßµ Ï†ïÏùò
// Í≤åÏûÑÏóêÏÑú ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÎßµÎì§Ïùò Í≤ΩÎ°ú Ï†ïÏùò
const MAPS = {
    STRAIGHT: {
        get name() { return t('straight'); },
        path: [
            { x: 0, y: 7 },
            { x: 1, y: 7 },
            { x: 2, y: 7 },
            { x: 3, y: 7 },
            { x: 4, y: 7 },
            { x: 5, y: 7 },
            { x: 6, y: 7 },
            { x: 7, y: 7 },
            { x: 8, y: 7 },
            { x: 9, y: 7 },
            { x: 10, y: 7 },
            { x: 11, y: 7 },
            { x: 12, y: 7 },
            { x: 13, y: 7 },
            { x: 14, y: 7 },
            { x: 15, y: 7 },
            { x: 16, y: 7 },
            { x: 17, y: 7 },
            { x: 18, y: 7 },
            { x: 19, y: 7 }
        ]
    },
    ZIGZAG: {
        get name() { return t('zigzag'); },
        path: [
            { x: 0, y: 7 },
            { x: 1, y: 4 },
            { x: 2, y: 1 },
            { x: 3, y: 5 },
            { x: 4, y: 8 },
            { x: 5, y: 11 },
            { x: 6, y: 13 },
            { x: 7, y: 10 },
            { x: 8, y: 7 },
            { x: 9, y: 4 },
            { x: 10, y: 1 },
            { x: 11, y: 5 },
            { x: 12, y: 8 },
            { x: 13, y: 11 },
            { x: 14, y: 13 },
            { x: 15, y: 10 },
            { x: 16, y: 7 },
            { x: 17, y: 4 },
            { x: 18, y: 1 },
            { x: 19, y: 5 }           
        ]
    },
    SPIRAL: {
        get name() { return t('spiral'); },
        path: [
            { x: 10, y: 7 },     // üåÄ ÏßÑÏßú ÎÇòÏÑ†Ìòï ÏãúÏûëÏ†ê
            { x: 12, y: 7 },
            { x: 12, y: 9 },
            { x: 10, y: 9 },
            { x: 8, y: 9 },
            { x: 8, y: 7 },
            { x: 8, y: 5 },
            { x: 10, y: 5 },
            { x: 12, y: 5 },
            { x: 14, y: 5 },
            { x: 14, y: 7 },
            { x: 14, y: 9 },
            { x: 14, y: 11 },
            { x: 12, y: 11 },
            { x: 10, y: 11 },
            { x: 8, y: 11 },
            { x: 6, y: 11 },
            { x: 6, y: 9 },
            { x: 6, y: 7 },
            { x: 6, y: 5 },
            { x: 6, y: 3 },
            { x: 8, y: 3 },
            { x: 10, y: 3 },
            { x: 12, y: 3 },
            { x: 14, y: 3 },
            { x: 16, y: 3 },
            { x: 16, y: 5 },
            { x: 16, y: 7 },
            { x: 16, y: 9 },
            { x: 16, y: 11 },
            { x: 16, y: 13 },
            { x: 14, y: 13 },
            { x: 12, y: 13 },
            { x: 10, y: 13 },
            { x: 8, y: 13 },
            { x: 6, y: 13 },
            { x: 4, y: 13 },
            { x: 2, y: 13 },
            { x: 0, y: 13 }     // üåÄ ÏßÑÏßú ÎÇòÏÑ†Ìòï ÎÅùÏ†ê
        ]
    },
    MAZE: {
        get name() { return t('maze'); },
        path: [
            { x: 10, y: 7 },
            { x: 5, y: 3 },
            { x: 15, y: 3 },
            { x: 5, y: 10 },
            { x: 15, y: 10 },
            { x: 5, y: 7 },
            { x: 15, y: 7 },
            { x: 20, y: 0 },
            { x: 18, y: 14 },
            { x: 4, y: 7 },
            { x: 8, y: 12 },
            { x: 13, y: 9 },
            { x: 10, y: 9 },
            { x: 12, y: 2 },
            { x: 7, y: 14 },
            { x: 3, y: 5 },
            { x: 11, y: 5 },
            { x: 17, y: 5 },
            { x: 14, y: 7 },
            { x: 10, y: 1 },
            { x: 6, y: 10 },
            { x: 19, y: 2 }
        ]
    },
    CROSS: {
        get name() { return t('cross'); },
        path: [
            { x: 3, y: 3 },
            { x: 5, y: 3 },
            { x: 7, y: 3 },
            { x: 7, y: 0 },
            { x: 9, y: 0 },
            { x: 10, y: 0 },
            { x: 12, y: 0 },
            { x: 12, y: 3 },
            { x: 14, y: 3 },
            { x: 16, y: 3 },
            { x: 16, y: 6 },
            { x: 14, y: 6 },
            { x: 12, y: 6 },
            { x: 12, y: 9 },
            { x: 12, y: 12 },
            { x: 12, y: 14 },
            { x: 10, y: 14 },
            { x: 9, y: 14 },
            { x: 7, y: 14 },
            { x: 7, y: 12 },
            { x: 7, y: 9 },
            { x: 7, y: 6 },
            { x: 5, y: 6 },
            { x: 3, y: 6 },
            { x: 3, y: 3 },
            { x: 7, y: 3 }
        ]
    },
    SNAKE: {
        get name() { return t('snake'); },
        path: [
            { x: 0, y: 3 },
            { x: 2, y: 3 },
            { x: 4, y: 3 },
            { x: 4, y: 5 },
            { x: 4, y: 7 },
            { x: 6, y: 7 },
            { x: 8, y: 7 },
            { x: 8, y: 5 },
            { x: 8, y: 3 },
            { x: 10, y: 3 },
            { x: 12, y: 3 },
            { x: 12, y: 5 },
            { x: 12, y: 7 },
            { x: 14, y: 7 },
            { x: 16, y: 7 },
            { x: 16, y: 5 },
            { x: 16, y: 3 },
            { x: 18, y: 3 },
            { x: 19, y: 3 }
        ]
    },
    DIAMOND: {
        get name() { return t('diamond'); },
        path: [
            { x: 9, y: 14 },            
            { x: 7, y: 12 },            
            { x: 5, y: 10 },            
            { x: 3, y: 8 },            
            { x: 1, y: 6 },
            { x: 1, y: 5 },            
            { x: 4, y: 2 },
            { x: 14, y: 2 },
            { x: 17, y: 5 },
            { x: 17, y: 6 },
            { x: 15, y: 8 },
            { x: 13, y: 10 },
            { x: 11, y: 12 },
            { x: 9, y: 14 },
            { x: 10, y: 12 },
            { x: 11, y: 10 },
            { x: 12, y: 8 },
            { x: 13, y: 6 },
            { x: 12, y: 4 },
            { x: 11, y: 2 },
            { x: 7, y: 2 },
            { x: 6, y: 4 },
            { x: 5, y: 6 },
            { x: 6, y: 8 },
            { x: 7, y: 10 },
            { x: 8, y: 12 },
            { x: 9, y: 14 },
            { x: 9, y: 6 },
            { x: 9, y: 2 }
            //{ x: 17, y: 5 },
            //{ x: 10, y: 9 },
            //{ x: 8, y: 9 },
            //{ x: 6, y: 9 },
            //{ x: 4, y: 9 },
            //{ x: 2, y: 9 },
            
        ]
    },
    STAR: {
        get name() { return t('star'); },
        path: [
            { x: 9, y: 0 },  // ÏãúÏûëÏ†ê
            { x: 6, y: 7 },  
            { x: 3, y: 14 },  
            { x: 8, y: 11 },  
            { x: 13, y: 8 },  
            { x: 18, y: 5 },  
            { x: 17, y: 5 },
            { x: 16, y: 5 },
            { x: 15, y: 5 },
            { x: 14, y: 5 },
            { x: 13, y: 5 },
            { x: 12, y: 5 },
            { x: 11, y: 5 },
            { x: 10, y: 5 },
            { x: 9, y: 5 },
            { x: 8, y: 5 },
            { x: 7, y: 5 },
            { x: 6, y: 5 },
            { x: 5, y: 5 },
            { x: 4, y: 5 },
            { x: 3, y: 5 },
            { x: 2, y: 5 },
            { x: 1, y: 5 },
            { x: 0, y: 5 },  
            { x: 3, y: 7 },  
            { x: 9, y: 11 },  
            { x: 14, y: 14 }, 
            { x: 11, y: 6 },  
            { x: 9, y: 0 } 
            //{ x: 19, y: 7 }, 
            //{ x: 15, y: 11 }, 
            //{ x: 14, y: 7 }, 
            //{ x: 10, y: 11 }, 
            //{ x: 8, y: 7 },  
            //{ x: 4, y: 11 }, 
            //{ x: 0, y: 7 }   
        ]
    },
    VORTEX: {
        get name() { return t('vortex'); },
        path: [
            { x: 0, y: 0 },     // üå™Ô∏è ÏÜåÏö©ÎèåÏù¥ ÏãúÏûëÏ†ê
            { x: 9, y: 0 },
            { x: 10, y: 0 },
            { x: 19, y: 0 },
            { x: 1, y: 2 },
            { x: 9, y: 2 },
            { x: 10, y: 2 },
            { x: 18, y: 2 },
            { x: 2, y: 4 },
            { x: 9, y: 4 },
            { x: 10, y: 4 },
            { x: 17, y: 4 },
            { x: 3, y: 6 },
            { x: 9, y: 6 },
            { x: 10, y: 6 },
            { x: 16, y: 6 },
            { x: 4, y: 8 },
            { x: 9, y: 8 },
            { x: 10, y: 8 },
            { x: 15, y: 8 },
            { x: 5, y: 10 },
            { x: 9, y: 10 },
            { x: 10, y: 10 },
            { x: 14, y: 10 },
            { x: 6, y: 11 },
            { x: 9, y: 11 },
            { x: 10, y: 11 },
            { x: 13, y: 11 },
            { x: 7, y: 12 },
            { x: 9, y: 12 },
            { x: 10, y: 12 },
            { x: 12, y: 12 },
            { x: 9, y: 14 }     // üå™Ô∏è ÏÜåÏö©ÎèåÏù¥ ÎÅùÏ†ê
        ]
    },
    MAZE2: {
        get name() { return t('maze2'); },
        path: [
            { x: 0, y: 7 },
            { x: 1, y: 7 },
            { x: 2, y: 7 },
            { x: 3, y: 7 },
            { x: 4, y: 7 },
            { x: 4, y: 5 },
            { x: 4, y: 3 },
            { x: 6, y: 3 },
            { x: 8, y: 3 },
            { x: 10, y: 3 },
            { x: 10, y: 5 },
            { x: 10, y: 7 },
            { x: 10, y: 9 },
            { x: 12, y: 9 },
            { x: 14, y: 9 },
            { x: 16, y: 9 },
            { x: 16, y: 7 },
            { x: 16, y: 5 },
            { x: 16, y: 3 },
            { x: 16, y: 1 },
            { x: 18, y: 1 },
            { x: 19, y: 1 }
        ]
    },
    SNAKE2: {
        get name() { return t('snake2'); },
        path: [
            { x: 0, y: 3 },
            { x: 2, y: 3 },
            { x: 4, y: 3 },
            { x: 4, y: 5 },
            { x: 4, y: 7 },
            { x: 6, y: 7 },
            { x: 8, y: 7 },
            { x: 8, y: 5 },
            { x: 8, y: 3 },
            { x: 10, y: 3 },
            { x: 12, y: 3 },
            { x: 12, y: 5 },
            { x: 12, y: 7 },
            { x: 14, y: 7 },
            { x: 16, y: 7 },
            { x: 16, y: 5 },
            { x: 16, y: 3 },
            { x: 18, y: 3 },
            { x: 19, y: 3 }
        ]
    },
    TRIANGLE: {
        get name() { return t('triangle'); },
        path: [

            { x: 9, y: 1 },   
            { x: 7, y: 4 },   
            { x: 3, y: 10 },   
            { x: 1, y: 13 },
            { x: 5, y: 13 },
            { x: 9, y: 13 }, 
            { x: 7, y: 10 },
            { x: 5, y: 7 },
            { x: 9, y: 7 },
            { x: 13, y: 7 }, 
            { x: 11, y: 10 },
            { x: 9, y: 13 }, 
            { x: 13, y: 13 },
            { x: 17, y: 13 },  
            { x: 15, y: 10 }, 
            { x: 11, y: 4 },   
            { x: 9, y: 1 }   
            //{ x: 12, y: 7 },  // Ïò§Î•∏Ï™ΩÏúºÎ°ú
            //{ x: 16, y: 7 },  // Ïò§Î•∏Ï™ΩÏúºÎ°ú
            //{ x: 19, y: 7 },  // Ïò§Î•∏Ï™Ω ÎÅù
            //{ x: 16, y: 11 }, // ÌïòÎã® Íº≠ÏßÄÏ†ê
            //{ x: 12, y: 11 }, // ÏôºÏ™ΩÏúºÎ°ú
            //{ x: 8, y: 11 },  // ÏôºÏ™ΩÏúºÎ°ú
            //{ x: 4, y: 11 },  // ÏôºÏ™ΩÏúºÎ°ú
            //{ x: 0, y: 7 }    // ÏãúÏûëÏ†êÏúºÎ°ú Î≥µÍ∑Ä

            // Î∞∞Î™®Ïñë
            //{ x: 0, y: 7 },   // ÏãúÏûëÏ†ê
            //{ x: 4, y: 7 },   // Ïò§Î•∏Ï™ΩÏúºÎ°ú
            //{ x: 8, y: 3 },   // ÏÉÅÎã® Íº≠ÏßÄÏ†ê
            //{ x: 12, y: 7 },  // Ïò§Î•∏Ï™ΩÏúºÎ°ú
            //{ x: 16, y: 7 },  // Ïò§Î•∏Ï™ΩÏúºÎ°ú
            //{ x: 19, y: 7 },  // Ïò§Î•∏Ï™Ω ÎÅù
            //{ x: 16, y: 11 }, // ÌïòÎã® Íº≠ÏßÄÏ†ê
            //{ x: 12, y: 11 }, // ÏôºÏ™ΩÏúºÎ°ú
            //{ x: 8, y: 11 },  // ÏôºÏ™ΩÏúºÎ°ú
            //{ x: 4, y: 11 },  // ÏôºÏ™ΩÏúºÎ°ú
            //{ x: 0, y: 7 }    // ÏãúÏûëÏ†êÏúºÎ°ú Î≥µÍ∑Ä
        ]
    },
    WAVE: {
        get name() { return t('wave'); },
        path: [
            { x: 0, y: 14 },
            { x: 1, y: 11 },
            { x: 2, y: 8 },
            { x: 3, y: 5 },
            { x: 5, y: 2 },
            //{ x: 6, y: 3 },
            //{ x: 7, y: 2 },
            //{ x: 8, y: 2 },
            { x: 7, y: 1 },
            //{ x: 9, y: 1 },
            { x: 10, y: 0 },
            { x: 12, y: 0 },
            //{ x: 12, y: 1 },
            //{ x: 13, y: 2 },
            { x: 14, y: 2 },
            { x: 15, y: 3 },
            { x: 16, y: 4 },
            { x: 15, y: 5 },
            { x: 14, y: 6 },
            { x: 12, y: 6 },
            { x: 13, y: 4 },
            { x: 12, y: 3 },
            { x: 11, y: 3 },
            { x: 9, y: 4 },
            { x: 8, y: 5 },
            //{ x: 8, y: 6 },
            { x: 7, y: 7 },
            { x: 7, y: 9 },
            /*{ x: 8, y: 10 },*/
            { x: 8, y: 11 },
            { x: 8, y: 12 },
            { x: 8, y: 13 },
            { x: 8, y: 14 },
            { x: 8, y: 13 },
            { x: 8, y: 12 },
            //{ x: 10, y: 11 },
            { x: 10, y: 9 },
            //{ x: 12, y: 9 },
            { x: 12, y: 8 },
            { x: 13, y: 8 },
            { x: 14, y: 8 },
            { x: 15, y: 9 },
            { x: 16, y: 10 },
            { x: 15, y: 11 },
            //{ x: 14, y: 11 },
            { x: 13, y: 11 },            
            { x: 14, y: 10 },
            { x: 12, y: 10 },
            { x: 11, y: 11 },
            { x: 11, y: 12 },
            /*{ x: 12, y: 12 },*/
            { x: 11, y: 13 },
            { x: 11, y: 14 },
            { x: 13, y: 13 },
            { x: 13, y: 14 }
        ]
    },
    STAIRS: {
        get name() { return t('stairs'); },
        path: [
            { x: 0, y: 1 },
            { x: 2, y: 1 },
            { x: 2, y: 3 },
            { x: 4, y: 3 },
            { x: 4, y: 5 },
            { x: 6, y: 5 },
            { x: 6, y: 7 },
            { x: 8, y: 7 },
            { x: 8, y: 9 },
            { x: 10, y: 9 },
            { x: 10, y: 11 },
            { x: 12, y: 11 },
            { x: 12, y: 9 },
            { x: 14, y: 9 },
            { x: 14, y: 7 },
            { x: 16, y: 7 },
            { x: 16, y: 5 },
            { x: 18, y: 5 },
            { x: 18, y: 3 },
            { x: 19, y: 3 }
        ]
    },
    CROSSROADS: {
        get name() { return t('crossroads'); },
        path: [
            { x: 0, y: 9 },
            { x: 0, y: 5 },
            { x: 3, y: 5 },
            { x: 6, y: 5 },
            { x: 8, y: 3 },
            { x: 8, y: 0 },
            { x: 12, y: 0 },
            { x: 12, y: 3 },
            { x: 14, y: 5 },
            { x: 19, y: 5 },
            { x: 19, y: 9 },
            { x: 14, y: 9 },
            { x: 12, y: 11 },
            { x: 12, y: 14 },
            { x: 8, y: 14 },
            { x: 8, y: 11 },
            { x: 6, y: 9 },
            { x: 3, y: 9 },
            { x: 0, y: 9 },
            { x: 0, y: 5 }            
        ]
    },
    INFINITY: {
        get name() { return t('infinity'); },
        path: [
            { x: 0, y: 7 },
            { x: 0, y: 6 },
            //{ x: 1, y: 5 },
            { x: 2, y: 4 },
            //{ x: 3, y: 3 },
            { x: 4, y: 2 },
            { x: 5, y: 2 },
            //{ x: 6, y: 3 },
            { x: 7, y: 4 },
            //{ x: 8, y: 5 },
            { x: 9, y: 6 },
            { x: 10, y: 7 },
            //{ x: 11, y: 8 },
            { x: 12, y: 9 },
            //{ x: 13, y: 10 },
            { x: 14, y: 11 },
            { x: 15, y: 11 },
            //{ x: 16, y: 10},
            { x: 17, y: 9 },
            //{ x: 18, y: 8 },
            { x: 19, y: 7 },
            { x: 19, y: 6 },
            //{ x: 18, y: 5 },
            { x: 17, y: 4 },
            //{ x: 16, y: 3 },
            { x: 15, y: 2 },
            { x: 14, y: 2 },
            //{ x: 13, y: 3 },
            { x: 12, y: 4 },
            //{ x: 11, y: 5 },
            { x: 10, y: 6 },
            { x: 9, y: 7 },
            //{ x: 8, y: 8 },
            { x: 7, y: 9 },
            //{ x: 6, y: 10 },
            { x: 5, y: 11 },
            { x: 4, y: 11 },
            //{ x: 3, y: 10 },
            { x: 2, y: 9 },
            //{ x: 1, y: 8 },
            { x: 0, y: 7 },
            { x: 0, y: 6 }
        ]
    },
    BUTTERFLY: {
        get name() { return t('butterfly'); },
        path: [
            { x: 7, y: 3 },
            { x: 8, y: 3 },
            { x: 9, y: 7 },
            { x: 5, y: 2 },
            { x: 3, y: 2 },
            { x: 3, y: 4 },
            { x: 3, y: 6 },
            { x: 3, y: 8 },
            { x: 3, y: 10 },
            { x: 3, y: 12 },
            { x: 3, y: 14 },            
            { x: 5, y: 14 },
            { x: 7, y: 11 },
            { x: 9, y: 8 },
            { x: 10, y: 7 },
            { x: 14, y: 2 },
            { x: 16, y: 2 },
            { x: 16, y: 4 },
            { x: 16, y: 6 },
            { x: 16, y: 8 },
            { x: 16, y: 10 },
            { x: 16, y: 12 },
            { x: 16, y: 14 },
            { x: 14, y: 14 },
            { x: 12, y: 11 },
            { x: 10, y: 8 },
            { x: 10, y: 7 },
            { x: 11, y: 3 },
            { x: 12, y: 3 }
        ]
    },
    HOURGLASS: {
        get name() { return t('hourglass'); },
        path: [
            { x: 13, y: 4 },
            { x: 13, y: 5 },
            { x: 9, y: 7 },
            { x: 5, y: 5 },
            { x: 5, y: 4 },
            { x: 9, y: 4 },
            { x: 13, y: 4 },
            { x: 13, y: 2 },
            { x: 13, y: 0 },
            { x: 11, y: 0 },
            { x: 9, y: 0 },
            { x: 7, y: 0 },
            { x: 5, y: 0 },
            { x: 5, y: 2 },
            { x: 5, y: 5 },
            { x: 9, y: 7 },
            { x: 9, y: 11 },
            { x: 5, y: 13 },
            { x: 5, y: 9 },
            { x: 9, y: 7 },
            { x: 13, y: 9 },
            { x: 13, y: 14 },
            { x: 11, y: 14 },
            { x: 9, y: 14 },
            { x: 7, y: 14 },
            { x: 5, y: 14 },
            { x: 5, y: 13 },
            { x: 9, y: 11 },
            { x: 13, y: 13 }
        ]
    },
    // === 1Îã®Í≥Ñ: Í∏∞Î≥∏ Í∏∞ÌïòÌïôÏ†Å Îßµ Ï∂îÍ∞Ä ===
    HEXAGON: {
        get name() { return t('hexagon'); },
        path: [
            { x: 8, y: 1 },
            { x: 10, y: 1 },
            { x: 12, y: 1 },
            { x: 13, y: 1 },
            { x: 14, y: 1 },
            { x: 16, y: 4 },
            { x: 18, y: 7 },
            { x: 16, y: 10 },
            { x: 14, y: 13 },
            { x: 13, y: 13 },
            { x: 12, y: 13 },
            { x: 11, y: 13 },
            { x: 10, y: 13 },
            { x: 9, y: 13 },
            { x: 8, y: 13 },
            { x: 7, y: 13 },
            { x: 6, y: 13 },
            { x: 5, y: 13 },
            { x: 3, y: 10 },
            { x: 1, y: 7 },
            { x: 3, y: 4 },
            { x: 5, y: 1 },
            { x: 6, y: 1 },
            { x: 7, y: 1 },
            { x: 9, y: 1 },
            { x: 11, y: 1 },
        ]
    },
    OCTAGON: {
        get name() { return t('octagon'); },
        path: [
            { x: 9, y: 2 },
            { x: 12, y: 2 },
            { x: 13, y: 3 },
            { x: 14, y: 4 },
            { x: 15, y: 5 },
            { x: 15, y: 7 },
            { x: 15, y: 8 },
            { x: 15, y: 10 },
            { x: 14, y: 11 },
            { x: 13, y: 12 },
            { x: 12, y: 13 },
            { x: 10, y: 13 },
            { x: 9, y: 13 },
            { x: 7, y: 13 },
            { x: 6, y: 12 },
            { x: 5, y: 11 },
            { x: 4, y: 10 },
            { x: 4, y: 8 },
            { x: 4, y: 7 },
            { x: 4, y: 5 },
            { x: 5, y: 4 },
            { x: 6, y: 3 },
            { x: 7, y: 2 },
            { x: 10, y: 2 },
        ]
    },
    PENTAGON: {
        get name() { return t('pentagon'); },
        path: [
            { x: 14, y: 13 },
            { x: 12, y: 13 },
            { x: 10, y: 13 },
            { x: 8, y: 13 },
            { x: 6, y: 13 },
            { x: 4, y: 13 },
            { x: 3, y: 13 },
            { x: 3, y: 11 },
            { x: 3, y: 9 },
            { x: 3, y: 7 },
            { x: 3, y: 6 },
            { x: 5, y: 4 },
            { x: 7, y: 2 },
            { x: 9, y: 0 },
            { x: 11, y: 2 },
            { x: 13, y: 4 },
            { x: 15, y: 6 },
            { x: 15, y: 8 },
            { x: 15, y: 10 },
            { x: 15, y: 12 },
            { x: 15, y: 13 },
            { x: 13, y: 13 },
            { x: 11, y: 13 },
            { x: 9, y: 13 },
            { x: 7, y: 13 },
            { x: 5, y: 13 },
        ]
    },
    SQUARE: {
        get name() { return t('square'); },
        path: [
            { x: 4, y: 1 },
            { x: 6, y: 1 },
            { x: 8, y: 1 },
            { x: 10, y: 1 },
            { x: 12, y: 1 },
            { x: 14, y: 1 },
            { x: 15, y: 1 },
            { x: 15, y: 3 },
            { x: 15, y: 5 },
            { x: 15, y: 7 },
            { x: 15, y: 9 },
            { x: 15, y: 11 },
            { x: 15, y: 13 },
            { x: 13, y: 13 },
            { x: 11, y: 13 },
            { x: 9, y: 13 },
            { x: 7, y: 13 },
            { x: 5, y: 13 },
            { x: 3, y: 13 },
            { x: 3, y: 11 },
            { x: 3, y: 9 },
            { x: 3, y: 7 },
            { x: 3, y: 5 },
            { x: 3, y: 3 },
            { x: 3, y: 1 },
            { x: 5, y: 1 },
            { x: 7, y: 1 },
            { x: 9, y: 1 },
            { x: 11, y: 1 },
            { x: 13, y: 1 },
        ]
    },
    RECTANGLE: {
        get name() { return t('rectangle'); },
        path: [
            { x: 3, y: 4 },
            { x: 5, y: 4 },
            { x: 7, y: 4 },
            { x: 9, y: 4 },
            { x: 11, y: 4 },
            { x: 13, y: 4 },
            { x: 15, y: 4 },
            { x: 17, y: 4 },
            { x: 17, y: 6 },
            { x: 17, y: 8 },
            { x: 17, y: 10 },
            { x: 15, y: 10 },
            { x: 13, y: 10 },
            { x: 11, y: 10 },
            { x: 9, y: 10 },
            { x: 7, y: 10 },
            { x: 5, y: 10 },
            { x: 3, y: 10 },
            { x: 2, y: 10 },
            { x: 2, y: 8 },
            { x: 2, y: 6 },
            { x: 2, y: 4 },
            { x: 4, y: 4 },
            { x: 6, y: 4 },
            { x: 8, y: 4 },
            { x: 10, y: 4 },
            { x: 12, y: 4 },
            { x: 14, y: 4 },
            { x: 16, y: 4 },            
        ]
    },
    CIRCLE: {
        get name() { return t('circle'); },
        path: [
            { x: 9, y: 1 },
            { x: 12, y: 2 },
            { x: 14, y: 4 },
            { x: 15, y: 7 },
            { x: 14, y: 10 },
            { x: 12, y: 12 },
            { x: 9, y: 13 },
            { x: 6, y: 12 },
            { x: 4, y: 10 },
            { x: 3, y: 7 },
            { x: 4, y: 4 },
            { x: 6, y: 2 },
            { x: 9, y: 1 },
            { x: 12, y: 2 }
        ]
    },
    ELLIPSE: {
        get name() { return t('ellipse'); },
        path: [
            { x: 6, y: 1 },
            { x: 12, y: 1 },
            { x: 15, y: 2 },
            { x: 17, y: 4 },
            { x: 18, y: 7 },
            { x: 17, y: 10 },
            { x: 15, y: 12 },
            { x: 12, y: 13 },
            { x: 6, y: 13 },
            { x: 3, y: 12 },
            { x: 1, y: 10 },
            { x: 0, y: 7 },
            { x: 1, y: 4 },
            { x: 3, y: 2 },
            { x: 6, y: 1 },
            { x: 12, y: 1 },
        ]
    },
    RHOMBUS: {
        get name() { return t('rhombus'); },
        path: [
            { x: 9, y: 1 },
            { x: 12, y: 4 },
            { x: 15, y: 7 },
            { x: 12, y: 10 },
            { x: 9, y: 13 },
            { x: 6, y: 10 },
            { x: 3, y: 7 },
            { x: 6, y: 4 },
            { x: 6, y: 4 },
            { x: 9, y: 1 },
            { x: 15, y: 7 },
        ]
    },
    TRAPEZOID: {
        get name() { return t('trapezoid'); },
        path: [
            { x: 6, y: 3 },
            { x: 8, y: 3 },
            { x: 10, y: 3 },
            { x: 12, y: 3 },
            { x: 13, y: 6 },
            { x: 14, y: 9 },
            { x: 15, y: 12 },
            { x: 13, y: 12 },
            { x: 11, y: 12 },
            { x: 9, y: 12 },
            { x: 7, y: 12 },
            { x: 5, y: 12 },
            { x: 3, y: 12 },                        
            { x: 4, y: 9 },
            { x: 5, y: 6 },
            { x: 6, y: 3 },
            { x: 7, y: 3 },
            { x: 9, y: 3 },
            { x: 11, y: 3 },
            { x: 12, y: 3 }
        ]
    },
    PARALLELOGRAM: {
        get name() { return t('parallelogram'); },
        path: [
            { x: 5, y: 3 },
            { x: 7, y: 3 },
            { x: 9, y: 3 },
            { x: 11, y: 3 },
            { x: 13, y: 3 },
            { x: 15, y: 3 },
            { x: 17, y: 3 },
            //{ x: 13, y: 6 },
            //{ x: 14, y: 9 },            
            { x: 13, y: 12 },
            { x: 11, y: 12 },
            { x: 9, y: 12 },
            { x: 7, y: 12 },
            { x: 5, y: 12 },
            { x: 3, y: 12 },
            { x: 1, y: 12 },
            //{ x: 4, y: 9 },
            //{ x: 5, y: 6 },
            { x: 5, y: 3 },
            { x: 6, y: 3 },
            { x: 8, y: 3 },
            { x: 10, y: 3 },
            { x: 12, y: 3 },
            { x: 14, y: 3 },
            { x: 16, y: 3 },
        ]
    },
    // === 2Îã®Í≥Ñ: ÏûêÏó∞/Ïú†Í∏∞Ï†Å Îßµ Ï∂îÍ∞Ä ===
    LEAF: {
        get name() { return t('leaf'); },
        path: [
            { x: 0, y: 14 },
            { x: 1, y: 13 },
            { x: 1, y: 9 },
            { x: 2, y: 5 },
            { x: 4, y: 9 },
            { x: 1, y: 13 },
            { x: 5, y: 12 },
            { x: 9, y: 10 },
            { x: 4, y: 9 },
            { x: 7, y: 6 },
            { x: 10, y: 3 },
            { x: 11, y: 0 },
            { x: 17, y: 0 },
            { x: 15, y: 4 },
            { x: 10, y: 3 },
            { x: 11, y: 0 },
            { x: 5, y: 2 },
            { x: 7, y: 6 },
            { x: 13, y: 7 },
            { x: 9, y: 10 },
            { x: 4, y: 9 },
            { x: 2, y: 5 },
            { x: 5, y: 2 },
            { x: 7, y: 6 },
            { x: 13, y: 7 },
            { x: 15, y: 4 },
            { x: 17, y: 0 },
            { x: 10, y: 3 }
        ]
    },
    FLOWER: {
        get name() { return t('flower'); },
        path: [
            { x: 9, y: 14 },
            { x: 9, y: 11 },
            { x: 5, y: 12 },
            { x: 3, y: 10 },
            { x: 5, y: 9 },
            { x: 9, y: 10 },
            { x: 9, y: 7 },
            { x: 7, y: 6 },
            { x: 7, y: 6 },
            { x: 6, y: 5 },
            { x: 5, y: 3 },
            { x: 5, y: 1 },
            { x: 7, y: 2 },
            { x: 9, y: 1 },
            { x: 11, y: 2 },
            { x: 13, y: 1 },
            { x: 13, y: 3 },
            { x: 12, y: 5 },
            { x: 11, y: 6 },
            { x: 9, y: 7 },
            { x: 9, y: 10 },
            { x: 13, y: 9 },
            { x: 15, y: 10 },
            { x: 13, y: 12 },
            { x: 9, y: 11 }
        ]
    },
    TREE: {
        get name() { return t('tree'); },
        path: [
            { x: 8, y: 14 },
            { x: 8, y: 11 },
            { x: 1, y: 13 },
            { x: 6, y: 8 },
            { x: 2, y: 9 },
            { x: 7, y: 4 },
            { x: 4, y: 5 },
            { x: 9, y: 1 },
            { x: 14, y: 5 },
            { x: 11, y: 4 },
            { x: 16, y: 9 },
            { x: 12, y: 8 },
            { x: 17, y: 13 },
            { x: 10, y: 11 },
            { x: 10, y: 14 }
        ]
    },
    CLOUD: {
        get name() { return t('cloud'); },
        path: [
            { x: 14, y: 14 }, 
            { x: 11, y: 14 },
            { x: 8, y: 14 },
            { x: 5, y: 14 },
            { x: 2, y: 13 },
            { x: 0, y: 11 },
            { x: 0, y: 8 },
            { x: 2, y: 5 },
            { x: 4, y: 5 },
            { x: 6, y: 6 },
            { x: 5, y: 3 },
            { x: 7, y: 1 },
            { x: 12, y: 2 },
            { x: 14, y: 5 },
            { x: 13, y: 7 },
            { x: 15, y: 6 },
            { x: 17, y: 6 },
            { x: 19, y: 9 },
            { x: 19, y: 11 },
            { x: 17, y: 13 },
            { x: 14, y: 14 },
            { x: 12, y: 14 },
            { x: 7, y: 14 },
            { x: 5, y: 14 }
        ]
    },
    RIVER: {
        get name() { return t('river'); },
        path: [
            { x: 12, y: 0 },
            { x: 3, y: 0 },
            { x: 8, y: 1 },
            { x: 10, y: 2 },
            { x: 11, y: 3 },
            { x: 11, y: 4 },
            { x: 10, y: 5 },
            { x: 4, y: 7 },
            { x: 2, y: 9 },
            { x: 1, y: 11 },
            { x: 1, y: 12 },
            { x: 2, y: 14 },
            { x: 16, y: 14 },
            { x: 13, y: 12 },
            { x: 12, y: 11 },
            { x: 12, y: 9 },
            { x: 13, y: 8 },
            { x: 16, y: 6 },
            { x: 17, y: 5 },
            { x: 17, y: 4 },
            { x: 16, y: 2 },
            { x: 14, y: 1 },
            { x: 12, y: 0 },
            { x: 3, y: 0 },
            
        ]
    },
    MOUNTAIN: {
        get name() { return t('mountain'); },
        path: [
            { x: 0, y: 14 },
            { x: 0, y: 9 },
            { x: 4, y: 1 },
            { x: 11, y: 8 },
            { x: 17, y: 14 },
            { x: 9, y: 6 },
            { x: 12, y: 2 },
            { x: 15, y: 5 },
            { x: 19, y: 9 },
            { x: 16, y: 6 },
            { x: 18, y: 3 },
            { x: 19, y: 4 },
            { x: 19, y: 14 },
            { x: 14, y: 14 },
            { x: 9, y: 14 },
            { x: 4, y: 14 },
            { x: 0, y: 14 },
            { x: 0, y: 9 }
        ]
    },
    WIND: {
        get name() { return t('wind'); },
        path: [
            { x: 0, y: 5 },
            { x: 4, y: 5 },
            { x: 10, y: 5 },
            { x: 14, y: 5 },
            { x: 16, y: 3 },
            { x: 16, y: 2 },
            { x: 14, y: 0 },
            { x: 13, y: 0 },
            { x: 11, y: 2 },
            { x: 13, y: 0 },
            { x: 14, y: 0 },
            { x: 16, y: 2 },
            { x: 16, y: 3 },
            { x: 14, y: 5 },
            { x: 7, y: 5 },
            { x: 0, y: 5 },
            { x: 0, y: 7 },
            { x: 3, y: 7 },
            { x: 9, y: 7 },
            { x: 12, y: 7 },
            { x: 6, y: 7 },
            { x: 0, y: 7 },
            { x: 0, y: 9 },
            { x: 5, y: 9 },
            { x: 10, y: 9 },
            { x: 15, y: 9 },
            { x: 17, y: 11 },
            { x: 17, y: 12 },
            { x: 17, y: 12 },
            { x: 15, y: 14 },
            { x: 14, y: 14 },
            { x: 12, y: 12 },
            
        ]
    },
    FIRE: {
        get name() { return t('fire'); },
        path: [
            { x: 12, y: 14 },
            { x: 9, y: 14 },            
            { x: 6, y: 13 },            
            { x: 4, y: 9 },
            { x: 6, y: 11 },
            { x: 5, y: 5 },
            { x: 7, y: 9 },
            { x: 9, y: 11 },
            { x: 7, y: 5 },
            { x: 8, y: 3 },
            { x: 8, y: 2 },
            { x: 9, y: 5 },
            { x: 9, y: 3 },
            { x: 10, y: 4 },
            { x: 11, y: 8 },
            { x: 12, y: 5 },
            { x: 12, y: 8 },
            { x: 14, y: 6 },
            { x: 12, y: 11 },
            { x: 15, y: 8 },
            { x: 14, y: 12 },
            { x: 12, y: 14 },
            { x: 9, y: 14 }
        ]
    },
    WATER: {
        get name() { return t('water'); },
        path: [
            { x: 9, y: 0 },
            { x: 7, y: 4 },
            { x: 5, y: 6 },
            { x: 4, y: 8 },
            { x: 4, y: 10 },
            { x: 5, y: 12 },
            { x: 6, y: 13 },
            { x: 8, y: 14 },
            { x: 10, y: 14 },
            { x: 12, y: 13 },
            { x: 13, y: 12 },
            { x: 14, y: 10 },
            { x: 14, y: 8 },
            { x: 13, y: 6 },
            { x: 11, y: 4 },
            { x: 9, y: 0 },
            { x: 7, y: 4 }
        ]
    },
    EARTH: {
        get name() { return t('earth'); },
        path: [
            { x: 11, y: 3 },
            { x: 7, y: 2 },
            { x: 3, y: 3 },
            { x: 0, y: 6 },
            { x: 0, y: 8 },
            { x: 2, y: 9 },
            { x: 2, y: 10 },
            { x: 3, y: 13 },
            { x: 4, y: 12 },
            { x: 4, y: 9 },
            { x: 5, y: 8 },
            { x: 6, y: 9 },
            { x: 7, y: 6 },
            { x: 8, y: 4 },
            { x: 11, y: 3 },
            { x: 13, y: 3 },
            { x: 14, y: 2 },
            { x: 16, y: 1 },
            { x: 19, y: 1 },
            { x: 19, y: 3 },
            { x: 15, y: 7 },
            { x: 18, y: 9 },
            { x: 15, y: 14 },
            { x: 15, y: 10 },
            { x: 14, y: 9 },
            { x: 14, y: 8 },
            { x: 15, y: 7 },
            { x: 14, y: 6 },
            { x: 13, y: 4 },
            { x: 12, y: 3 }
        ]
    },
    // === 3Îã®Í≥Ñ: Í≥†Í∏â/Î≥µÌï© Îßµ Ï∂îÍ∞Ä ===
    LABYRINTH: {
        get name() { return t('labyrinth'); },
        path: [

            { x: 9, y: 7 },
            { x: 12, y: 7 },
            { x: 12, y: 10 },
            { x: 14, y: 10 },
            { x: 14, y: 5 },
            { x: 7, y: 5 },
            { x: 7, y: 9 },
            { x: 10, y: 9 },
            { x: 10, y: 11 },
            { x: 5, y: 11 },
            { x: 5, y: 3 },
            { x: 16, y: 3 },
            { x: 16, y: 12 },
            { x: 12, y: 12 },
            { x: 12, y: 13 },
            { x: 3, y: 13 },
            { x: 3, y: 1 },
            { x: 18, y: 1 },
            { x: 18, y: 14 },
            { x: 13, y: 14 }
        ]
    },
    MAZE_COMPLEX: {
        get name() { return t('mazeComplex'); },
        path: [
            { x: 4, y: 5 },
            { x: 7, y: 5 },
            { x: 7, y: 8 },
            { x: 9, y: 8 },
            { x: 9, y: 3 },
            { x: 2, y: 3 },
            { x: 2, y: 7 },
            { x: 5, y: 7 },
            { x: 5, y: 9 },
            { x: 0, y: 9 },
            { x: 0, y: 1 },
            { x: 19, y: 1 },
            { x: 19, y: 9 },
            { x: 13, y: 9 },

            { x: 13, y: 7 },
            { x: 17, y: 7 },
            { x: 17, y: 3 },
            { x: 11, y: 3 },
            { x: 11, y: 5 },
            { x: 15, y: 5 },
            { x: 11, y: 5 },
            { x: 11, y: 11 },
            { x: 18, y: 11 },
            { x: 18, y: 13 },
            { x: 9, y: 13 },
            { x: 9, y: 10 },
            { x: 7, y: 10 },
            { x: 7, y: 11 },
            { x: 1, y: 11 },
            { x: 1, y: 13 },
            { x: 7, y: 13 },
            { x: 7, y: 14 },
            /*{ x: 11, y: 12 },*/
            /*{ x: 8, y: 12 },*/
            
            //{ x: 3, y: 13 },
            //{ x: 3, y: 1 },
            //{ x: 18, y: 1 },
            //{ x: 18, y: 14 },
            //{ x: 13, y: 14 }
        ]
    },
    SPIRAL_DOUBLE: {
        get name() { return t('spiralDouble'); },
        path: [
            { x: 4, y: 7 },
            { x: 6, y: 7 },
            { x: 6, y: 9 },
            { x: 2, y: 9 },
            { x: 2, y: 5 },
            { x: 8, y: 5 },
            { x: 8, y: 11 },
            { x: 0, y: 11 },
            { x: 0, y: 3 },
            { x: 19, y: 3 },
            { x: 19, y: 11 },
            { x: 11, y: 11 },
            { x: 11, y: 5 },
            { x: 17, y: 5 },
            { x: 17, y: 9 },
            { x: 13, y: 9 },
            { x: 13, y: 7 },
            { x: 15, y: 7 }
        ]
    },
    CROSS_DOUBLE: {
        get name() { return t('crossDouble'); },
        path: [
            { x: 9, y: 4 },
            { x: 9, y: 7 },
            { x: 6, y: 7 },
            { x: 6, y: 14 },
            { x: 3, y: 14 },
            { x: 3, y: 7 },
            { x: 0, y: 7 },
            { x: 0, y: 4 },
            { x: 3, y: 4 },
            { x: 3, y: 1 },
            { x: 6, y: 1 },
            { x: 6, y: 4 },
            { x: 13, y: 4 },
            { x: 13, y: 1 },
            { x: 16, y: 1 },
            { x: 16, y: 4 },
            { x: 19, y: 4 },            
            { x: 19, y: 7 },
            { x: 16, y: 7 },
            { x: 16, y: 14 },
            { x: 13, y: 14 },
            { x: 13, y: 7 },
            { x: 10, y: 7 },
            { x: 10, y: 4 },

        ]
    },
    SNAKE_ADVANCED: {
        get name() { return t('snakeAdvanced'); },
        path: [
            { x: 0, y: 14 },
            { x: 1, y: 12 },
            { x: 4, y: 13 },
            { x: 2, y: 10 },
            { x: 2, y: 8 },
            { x: 4, y: 8 },
            { x: 7, y: 12 },
            { x: 9, y: 12 },
            { x: 9, y: 10 },
            { x: 6, y: 6 },
            { x: 6, y: 4 },
            { x: 8, y: 4 },
            { x: 11, y: 8 },
            { x: 13, y: 8 },
            { x: 13, y: 6 },
            { x: 13, y: 6 },
            { x: 11, y: 3 },
            { x: 11, y: 1 },
            { x: 13, y: 1 },
            { x: 15, y: 4 },
            { x: 17, y: 4 },
            { x: 17, y: 1 },
            { x: 18, y: 0 },
            //{ x: 4, y: 7 },
            //{ x: 6, y: 7 },
            //{ x: 8, y: 7 },
            //{ x: 8, y: 5 },
            //{ x: 8, y: 3 },
            //{ x: 10, y: 3 },
            //{ x: 12, y: 3 },
            //{ x: 12, y: 5 },
            //{ x: 12, y: 7 },
            //{ x: 14, y: 7 },
            //{ x: 16, y: 7 },
            //{ x: 16, y: 5 },
            //{ x: 16, y: 3 },
            //{ x: 18, y: 3 },
            //{ x: 19, y: 3 }
        ]
    },
    VORTEX_DOUBLE: {
        get name() { return t('vortexDouble'); },
        path: [
            { x: 5, y: 14 },             
            { x: 6, y: 13 },
            { x: 4, y: 12 },            
            { x: 7, y: 11 },
            { x: 3, y: 10 },            
            { x: 8, y: 9 },
            { x: 2, y: 8 },
            { x: 9, y: 7 },
            { x: 1, y: 6 },
            { x: 10, y: 5 },
            { x: 0, y: 4 },
            { x: 7, y: 3 },
            { x: 3, y: 2 },
            { x: 16, y: 2 },
            { x: 12, y: 3 },
            { x: 19, y: 4 },
            { x: 9, y: 5 },
            { x: 18, y: 6 },
            { x: 10, y: 7 },
            { x: 17, y: 8 },
            { x: 11, y: 9 },
            { x: 16, y: 10 },
            { x: 12, y: 11 },
            { x: 15, y: 12 },
            { x: 13, y: 13 },
            { x: 14, y: 14 },
        ]
    },
    INFINITY_DOUBLE: {
        get name() { return t('infinityDouble'); },
        path: [
            { x: 0, y: 6 },
            { x: 0, y: 5 },
            { x: 3, y: 2 },
            { x: 4, y: 2 },
            { x: 11, y: 9 },
            { x: 12, y: 9 },
            { x: 15, y: 6 },
            { x: 15, y: 5 },
            { x: 12, y: 2 },
            { x: 11, y: 2 },
            { x: 4, y: 9 },
            { x: 3, y: 9 },
            { x: 0, y: 6 },
            { x: 2, y: 8 },
            { x: 4, y: 6 },
            { x: 5, y: 6 },            
            { x: 12, y: 13 },
            { x: 13, y: 13 },
            { x: 16, y: 10 },
            { x: 16, y: 9 },
            { x: 13, y: 6 },
            { x: 12, y: 6 },
            { x: 5, y: 13 },
            { x: 4, y: 13 },
            { x: 1, y: 10 },
            { x: 1, y: 9 },
            { x: 4, y: 6 },
            /*{ x: 0, y: 5 }*/
        ]
    },
    BUTTERFLY_DOUBLE: {
        get name() { return t('butterflyDouble'); },
        path: [
            //{ x: 3, y: 3 },
            { x: 4, y: 3 },
            { x: 4, y: 7 },
            { x: 2, y: 12 },            
            { x: 0, y: 12 },
            { x: 0, y: 2 },
            { x: 2, y: 2 },
            { x: 6, y: 12 },
            { x: 8, y: 12 },
            { x: 8, y: 2 },
            { x: 6, y: 2 },
            { x: 4, y: 7 },
            { x: 6, y: 12 },
            { x: 11, y: 12 },
            { x: 13, y: 12 },
            { x: 17, y: 2 },
            { x: 19, y: 2 },
            { x: 19, y: 12 },
            { x: 17, y: 12 },
            { x: 13, y: 2 },
            { x: 11, y: 2 },
            { x: 11, y: 12 },
            { x: 13, y: 12 },
            { x: 15, y: 7 },
            { x: 15, y: 3 }
        ]
    },
    HOURGLASS_DOUBLE: {
        get name() { return t('hourglassDouble'); },
        path: [
            { x: 8, y: 4 },
            { x: 8, y: 5 },
            { x: 4, y: 7 },
            { x: 0, y: 5 },
            { x: 0, y: 4 },
            { x: 8, y: 4 },
            { x: 8, y: 0 },
            { x: 0, y: 0 },
            { x: 0, y: 5 },
            { x: 4, y: 7 },
            { x: 4, y: 11 },
            { x: 0, y: 13 },
            { x: 0, y: 9 },
            { x: 4, y: 7 },
            { x: 8, y: 9 },
            { x: 8, y: 14 },
            { x: 0, y: 14 },
            { x: 0, y: 13 },
            { x: 4, y: 11 },
            { x: 8, y: 13 },
            { x: 8, y: 14 },

            { x: 11, y: 14 },
            { x: 19, y: 14 },
            { x: 19, y: 13 },
            { x: 15, y: 11 },
            { x: 11, y: 13 },
            { x: 11, y: 9 },
            { x: 15, y: 7 },
            { x: 19, y: 9 },
            { x: 19, y: 13 },
            { x: 15, y: 11 },
            { x: 15, y: 7 },
            { x: 11, y: 5 },
            { x: 11, y: 0 },
            { x: 19, y: 0 },
            { x: 19, y: 5 },
            { x: 15, y: 7 },
            { x: 11, y: 5 },
            { x: 11, y: 4 },
            { x: 19, y: 4 },
        ]
    },
    CHALLENGE_ULTIMATE: {
        get name() { return t('challengeUltimate'); },
        path: [
            { x: 0, y: 0 },
            { x: 4, y: 4 },
            { x: 15, y: 4 },
            { x: 15, y: 4 },
            { x: 19, y: 0 },
            { x: 19, y: 14 },
            { x: 15, y: 9 },
            { x: 4, y: 9 },
            { x: 0, y: 14 },
            { x: 0, y: 0 },
            { x: 7, y: 0 },
            { x: 7, y: 14 },
            { x: 12, y: 14 },
            { x: 12, y: 0 },
            { x: 19, y: 0 }
        ]
    },
    // === 4Îã®Í≥Ñ: Îã§ÏñëÌïú ÏãúÏûë/ÎÅùÏ†êÏùÑ Í∞ÄÏßÑ ÏÉàÎ°úÏö¥ ÎßµÎì§ ===
    TOP_TO_BOTTOM: {
        get name() { return t('topToBottom'); },
        path: [
            { x: 0, y: 14 },
            { x: 1, y: 0 },
            { x: 2, y: 14 },
            { x: 3, y: 0 },
            { x: 4, y: 14 },
            { x: 5, y: 0 },
            { x: 6, y: 14 },
            { x: 7, y: 0 },
            { x: 8, y: 14 },
            { x: 9, y: 0 },
            { x: 10, y: 14 },
            { x: 11, y: 0 },
            { x: 12, y: 14 },
            { x: 13, y: 0 },
            { x: 14, y: 14 },
            { x: 15, y: 0 },
            { x: 16, y: 14 },
            { x: 17, y: 0 },
            { x: 18, y: 14 },
            { x: 19, y: 0 }
        ]
    },
    DIAGONAL_CROSS: {
        get name() { return t('diagonalCross'); },
        path: [
            { x: 3, y: 3 },
            //{ x: 4, y: 2 },
            { x: 5, y: 1 },
            //{ x: 6, y: 2 },
            { x: 7, y: 3 },
            //{ x: 8, y: 2 },
            { x: 9, y: 1 },
            //{ x: 10, y: 2 },
            { x: 11, y: 3 },
            //{ x: 10, y: 4 },
            { x: 9, y: 5 },
            //{ x: 10, y: 6 },
            { x: 11, y: 7 },
            //{ x: 12, y: 8 },
            { x: 13, y: 9 },
            //{ x: 14, y: 10 },
            { x: 15, y: 11 },
            { x: 16, y: 12 },
            //{ x: 15, y: 13 },
            { x: 14, y: 14 },
            //{ x: 13, y: 13 },
            { x: 12, y: 12 },
            //{ x: 11, y: 11 },
            { x: 10, y: 10 },
            //{ x: 9, y: 9 },
            { x: 8, y: 8 },
            { x: 7, y: 7 },
            //{ x: 6, y: 8 },
            { x: 5, y: 9 },
            //{ x: 4, y: 8 },
            { x: 3, y: 7 },
            //{ x: 4, y: 6 },
            { x: 5, y: 5 },
            //{ x: 4, y: 4 },
            { x: 3, y: 3 },
            { x: 5, y: 1 }
        ]
    },
    CENTER_SPIRAL: {
        get name() { return t('centerSpiral'); },
        path: [
            { x: 10, y: 7 },
            { x: 13, y: 7 },
            { x: 16, y: 7 },
            { x: 16, y: 11 },
            { x: 13, y: 11 },
            { x: 10, y: 11 },
            { x: 7, y: 11 },
            { x: 4, y: 11 },
            { x: 4, y: 9 },
            { x: 4, y: 7 },
            { x: 4, y: 5 },
            { x: 4, y: 3 },
            { x: 7, y: 3 },
            { x: 10, y: 3 },
            { x: 13, y: 3 },
            { x: 16, y: 3 },
            { x: 19, y: 3 },
            { x: 19, y: 6 },
            { x: 19, y: 9 },            
            { x: 19, y: 11 },
            { x: 19, y: 14 },
            { x: 16, y: 14 },
            { x: 13, y: 14 },
            { x: 10, y: 14 },
            { x: 7, y: 14 },
            { x: 4, y: 14 },
            { x: 2, y: 14 },
            { x: 0, y: 14 },
            { x: 0, y: 11 },
            { x: 0, y: 8 },
            { x: 0, y: 5 },
            { x: 0, y: 2 },
            { x: 0, y: 0 },
            { x: 3, y: 0 },
            { x: 6, y: 0 },
            { x: 9, y: 0 },
            { x: 12, y: 0 },
            { x: 15, y: 0 },
            { x: 17, y: 0 },
            { x: 19, y: 0 }
        ]
    },
    BOTTOM_TO_TOP: {
        get name() { return t('bottomToTop'); },
        path: [
            { x: 0, y: 0 },
            { x: 1, y: 14 },
            { x: 2, y: 0 },
            { x: 3, y: 14 },
            { x: 4, y: 0 },
            { x: 5, y: 14 },
            { x: 6, y: 0 },
            { x: 7, y: 14 },
            { x: 8, y: 0 },
            { x: 9, y: 14 },
            { x: 10, y: 0 },
            { x: 11, y: 14 },
            { x: 12, y: 0 },
            { x: 13, y: 14 },
            { x: 14, y: 0 },
            { x: 15, y: 14 },
            { x: 16, y: 0 },
            { x: 17, y: 14 },
            { x: 18, y: 0 },
            { x: 19, y: 14 }
        ]
    },
    CORNER_TO_CORNER: {
        get name() { return t('cornerToCorner'); },
        path: [
            { x: 0, y: 3 },     
            { x: 0, y: 2 },     
            { x: 0, y: 1 },     
            { x: 0, y: 0 },     
            { x: 1, y: 0 },     
            { x: 2, y: 0 },
            { x: 3, y: 0 },
            { x: 16, y: 0 },
            { x: 17, y: 0 },
            { x: 18, y: 0 },
            { x: 19, y: 0 },
            { x: 19, y: 1 },
            { x: 19, y: 2 },
            { x: 19, y: 3 },
            { x: 19, y: 11 },
            { x: 19, y: 12 },
            { x: 19, y: 13 },
            { x: 19, y: 14 },
            { x: 18, y: 14 },
            { x: 17, y: 14 },
            { x: 16, y: 14 },
            { x: 3, y: 14 },
            { x: 2, y: 14 },
            { x: 1, y: 14 },
            { x: 0, y: 14 },
            { x: 0, y: 13 },
            { x: 0, y: 12 },
            { x: 0, y: 11 }
        ]
    }
};

// ÌÉÄÏõå ÏïÑÏù¥ÏΩò Ï†ïÏùò
// Í∞Å ÌÉÄÏõå ÌÉÄÏûÖÎ≥Ñ ÏïÑÏù¥ÏΩò
const TOWER_ICONS = {
    BASIC: '‚öîÔ∏è',    // Í∏∞Î≥∏ ÌÉÄÏõå
    ICE: '‚ùÑÔ∏è',      // ÏñºÏùå ÌÉÄÏõå
    POISON: '‚ò†Ô∏è',   // ÎèÖ ÌÉÄÏõå
    LASER: 'üî¥',    // Î†àÏù¥Ï†Ä ÌÉÄÏõå
    SPLASH: 'üí•',   // Ïä§ÌîåÎûòÏãú ÌÉÄÏõå
    SUPPORT: 'üí´'   // ÏßÄÏõê ÌÉÄÏõå
};

// ÌååÏõåÏóÖ Ï†ïÏùò
// Í≤åÏûÑ ÎÇ¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÌååÏõåÏóÖ Ìö®Í≥º
const POWERUPS = {
    GOLD: {
        get name() { return t('powerupGold'); },
        cost: 100,
        duration: 30000,
        effect: () => {
            gameState.goldMultiplier = 2;
            setTimeout(() => {
                gameState.goldMultiplier = 1;
            }, 30000);
        }
    },
    DAMAGE: {
        get name() { return t('powerupDamage'); },
        cost: 150,
        duration: 30000,
        effect: () => {
            towers.forEach(tower => {
                tower.damage *= 2;
            });
            setTimeout(() => {
                towers.forEach(tower => {
                    tower.damage /= 2;
                });
            }, 30000);
        }
    },
    FREEZE: {
        get name() { return t('powerupFreeze'); },
        cost: 200,
        duration: 10000,
        effect: () => {
            enemies.forEach(enemy => {
                enemy.speed = 0;
            });
            setTimeout(() => {
                enemies.forEach(enemy => {
                    enemy.speed = enemy.baseSpeed;
                });
            }, 10000);
        }
    }
};

// ÌäπÏàò Ïù¥Î≤§Ìä∏ Ï†ïÏùò
// Í≤åÏûÑ Ï§ë Î∞úÏÉùÌïòÎäî ÌäπÏàò Ïù¥Î≤§Ìä∏
const SPECIAL_EVENTS = {
    GOLD_RUSH: {
        get name() { return t('specialEventGoldRush'); },
        get description() { return t('specialEventGoldRushDesc'); },
        duration: 30000,
        effect: () => {
            gameState.goldMultiplier = 2;
            showEventNotification(t('specialEventGoldRushStart'));
            setTimeout(() => {
                gameState.goldMultiplier = 1;
                showEventNotification(t('specialEventGoldRushEnd'));
            }, 30000);
        }
    },
    TOWER_POWER: {
        get name() { return t('specialEventTowerPower'); },
        get description() { return t('specialEventTowerPowerDesc'); },
        duration: 25000,
        effect: () => {
            towers.forEach(tower => {
                tower.damage *= 1.5;
            });
            showEventNotification(t('specialEventTowerPowerStart'));
            setTimeout(() => {
                towers.forEach(tower => {
                    tower.damage /= 1.5;
                });
                showEventNotification(t('specialEventTowerPowerEnd'));
            }, 25000);
        }
    },
    TIME_FREEZE: {
        get name() { return t('specialEventTimeFreeze'); },
        get description() { return t('specialEventTimeFreezeDesc'); },
        duration: 20000,
        effect: () => {
            enemies.forEach(enemy => {
                enemy.speed *= 0.2;
            });
            showEventNotification(t('specialEventTimeFreezeStart'));
            setTimeout(() => {
                enemies.forEach(enemy => {
                    enemy.speed = enemy.baseSpeed;
                });
                showEventNotification(t('specialEventTimeFreezeEnd'));
            }, 20000);
        }
    },
    ENEMY_WEAKNESS: {
        get name() { return t('specialEventEnemyWeakness'); },
        get description() { return t('specialEventEnemyWeaknessDesc'); },
        duration: 25000,
        effect: () => {
            enemies.forEach(enemy => {
                enemy.health *= 0.7;
                enemy.maxHealth *= 0.7;
            });
            showEventNotification(t('specialEventEnemyWeaknessStart'));
            setTimeout(() => {
                showEventNotification(t('specialEventEnemyWeaknessEnd'));
            }, 25000);
        }
    }
};

// ÏóÖÏ†Å Ï†ïÏùò
// Í≤åÏûÑ ÎÇ¥ Îã¨ÏÑ± Í∞ÄÎä•Ìïú ÏóÖÏ†Å
const ACHIEVEMENTS = {
    FIRST_TOWER: {
        get name() { return t('achievementFirstTower'); },
        get description() { return t('achievementFirstTowerDesc'); },
        condition: () => towers.length === 1,
        unlocked: false
    },
    BOSS_KILLER: {
        get name() { return t('achievementBossKiller'); },
        get description() { return t('achievementBossKillerDesc'); },
        condition: () => gameState.bossKilled,
        unlocked: false
    },
    TOWER_MASTER: {
        get name() { return t('achievementTowerMaster'); },
        get description() { return t('achievementTowerMasterDesc'); },
        condition: () => {
            const towerTypes = new Set(towers.map(t => t.type));
            return towerTypes.size === Object.keys(window.TOWER_TYPES).length;
        },
        unlocked: false
    },
    WAVE_MASTER: {
        get name() { return t('achievementWaveMaster'); },
        get description() { return t('achievementWaveMasterDesc'); },
        condition: () => gameState.wave >= 10,
        unlocked: false
    },
    TOWER_EXPERT: {
        get name() { return t('achievementTowerExpert'); },
        get description() { return t('achievementTowerExpertDesc'); },
        condition: () => towers.some(tower => tower.level >= 10),
        unlocked: false
    },
    GOLD_COLLECTOR: {
        get name() { return t('achievementGoldCollector'); },
        get description() { return t('achievementGoldCollectorDesc'); },
        condition: () => gameStats.totalGold >= 10000,
        unlocked: false
    },
    EVENT_MASTER: {
        get name() { return t('achievementEventMaster'); },
        get description() { return t('achievementEventMasterDesc'); },
        condition: () => Object.keys(SPECIAL_EVENTS).every(event => gameStats.eventsTriggered?.includes(event)),
        unlocked: false
    }
};

// ÌÉÄÏõå Ï°∞Ìï© Ï†ïÏùò
// ÌÉÄÏõåÎì§ Í∞ÑÏùò ÌäπÎ≥ÑÌïú Ï°∞Ìï© Ìö®Í≥º
const TOWER_COMBOS = {
    ICE_POISON: {
        get name() { return t('comboIcePoison'); },
        get description() { return t('comboIcePoisonDesc'); },
        condition: (towers) => {
            return towers.some(t => t.type === 'ICE') &&
                towers.some(t => t.type === 'POISON');
        },
        effect: (towers) => {
            const iceTower = towers.find(t => t.type === 'ICE');
            const poisonTower = towers.find(t => t.type === 'POISON');
            if (iceTower && poisonTower) {
                // Ïù¥Ï†Ñ Ìö®Í≥º Ï†úÍ±∞
                if (iceTower.activeCombos.has('ICE_POISON')) {
                    poisonTower.poisonDamage /= 1.5;
                    iceTower.freezeDuration -= 2;
                }
                // ÏÉà Ìö®Í≥º Ï†ÅÏö©
                poisonTower.poisonDamage *= 1.5;
                iceTower.freezeDuration += 2;
            }
        }
    },
    SUPPORT_NETWORK: {
        get name() { return t('comboSupportNetwork'); },
        get description() { return t('comboSupportNetworkDesc'); },
        condition: (towers) => {
            return towers.some(t => t.type === 'SUPPORT');
        },
        effect: (towers) => {
            const supportTowers = towers.filter(t => t.type === 'SUPPORT');
            supportTowers.forEach(support => {
                // Ïù¥Ï†Ñ Î≤ÑÌîÑ Ï†úÍ±∞
                support.removeBuffs();
                // ÏÉà Î≤ÑÌîÑ Ï†ÅÏö©
                towers.forEach(tower => {
                    if (tower !== support) {
                        const dx = tower.x - support.x;
                        const dy = tower.y - support.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance <= support.buffRange) {
                            tower.damage *= support.buffMultiplier;
                            support.buffedTowers.add(tower);
                        }
                    }
                });
            });
        }
    },
    ELEMENTAL_MASTERY: {
        get name() { return t('comboElementalMastery'); },
        get description() { return t('comboElementalMasteryDesc'); },
        condition: (towers) => {
            const requiredTypes = ['BASIC', 'ICE', 'POISON', 'LASER', 'SPLASH', 'SUPPORT'];
            return requiredTypes.every(type => towers.some(t => t.type === type));
        },
        effect: (towers) => {
            towers.forEach(tower => {
                // Ïù¥Ï†Ñ Ìö®Í≥º Ï†úÍ±∞
                if (tower.activeCombos.has('ELEMENTAL_MASTERY')) {
                    switch (tower.type) {
                        case 'ICE':
                            tower.freezeDuration /= 2;
                            break;
                        case 'POISON':
                            tower.poisonDamage /= 2;
                            tower.poisonDuration /= 2;
                            break;
                        case 'LASER':
                            tower.continuousDamage /= 2;
                            break;
                        case 'SPLASH':
                            tower.splashRadius /= 1.5;
                            tower.slowEffect /= 1.5;
                            break;
                    }
                }
                // ÏÉà Ìö®Í≥º Ï†ÅÏö©
                switch (tower.type) {
                    case 'ICE':
                        tower.freezeDuration *= 2;
                        break;
                    case 'POISON':
                        tower.poisonDamage *= 2;
                        tower.poisonDuration *= 2;
                        break;
                    case 'LASER':
                        tower.continuousDamage *= 2;
                        break;
                    case 'SPLASH':
                        tower.splashRadius *= 1.5;
                        tower.slowEffect *= 1.5;
                        break;
                }
            });
        }
    }
};

// ÌäπÏàò Îä•Î†• Ï†ïÏùò
// ÌÉÄÏõåÎÇò Ï†ÅÏù¥ Í∞ÄÏßÑ ÌäπÏàò Îä•Î†•
const ABILITIES = {
    TOWER_BOOST: {
        get name() { return t('abilityTowerBoost'); },
        cost: 300
    }
};

// Î≥¥Ïä§ Ìå®ÌÑ¥ Ï†ïÏùò
const BOSS_PATTERNS = {
    SHIELD: {
        get name() { return t('bossPatternShield'); },
        cooldown: 300,
        duration: 180,
        update: (boss) => {
            if (boss.isDead) return true;

            if (boss.patternCooldown === 0) {
                boss.isInvincible = true;
                boss.defense = 50;
                showBossPatternEffect(boss.x, boss.y, t('bossPatternShield'));
                playSound('bossShield');
            }

            if (boss.patternCooldown === boss.pattern.duration) {
                boss.isInvincible = false;
                boss.defense = 0;
            }

            return false;
        }
    },
    TELEPORT: {
        get name() { return t('bossPatternTeleport'); },
        cooldown: 300, // 5Ï¥à
        update: (boss) => {
            if (boss.isDead) return true;
            if (boss.patternCooldown === 0) {
                // ÌòÑÏû¨ pathIndexÏóêÏÑú 2~3Ïπ∏ Ïïû(ÎûúÎç§)ÏúºÎ°ú ÏàúÍ∞ÑÏù¥Îèô
                const jump = Math.floor(Math.random() * 2) + 2; // 2~3Ïπ∏
                let newIndex = Math.min(boss.pathIndex + jump, currentMap.path.length - 1);
                boss.pathIndex = newIndex;
                const target = currentMap.path[newIndex];
                boss.x = target.x;
                boss.y = target.y;
                showBossPatternEffect(boss.x, boss.y, t('bossPatternTeleport'));
                playSound('bossTeleport');
            }
            return false;
        }
    },
    HEAL: {
        get name() { return t('bossPatternHeal'); },
        cooldown: 240,
        update: (boss) => {
            if (boss.isDead) return true;
            // Ïø®Îã§Ïö¥ 60ÌîÑÎ†àÏûÑ(1Ï¥à) Ï†Ñ ÏòàÍ≥†
            // if (boss.patternCooldown === 60) showBossPatternWarning(boss.x, boss.y, t('bossPatternHeal'));
            // Ï≤¥Î†• 50% Ïù¥ÌïòÏùº ÎïåÎßå Ìûê ÏÇ¨Ïö©
            if (boss.health / boss.maxHealth <= 0.5 && boss.patternCooldown === 0) {
                const healAmount = Math.floor(boss.maxHealth * 0.4);
                boss.health = Math.min(boss.maxHealth, boss.health + healAmount);
                showBossPatternEffect(boss.x, boss.y, t('bossPatternHealStrong'));
                playSound('bossHeal');
            } else if (boss.patternCooldown === 0) {
                // 50% Ï¥àÍ≥ºÎ©¥ ÏÜåÌôò ÌñâÎèô
                // ÏÜåÌôò: ÏùºÎ∞ò Ï†Å 2~3ÎßàÎ¶¨ ÏÉùÏÑ±
                const summonCount = Math.floor(Math.random() * 2) + 2; // 2~3ÎßàÎ¶¨
                for (let i = 0; i < summonCount; i++) {
                    const enemy = new Enemy(gameState.wave, false);
                    // ÏÜåÌôò ÏúÑÏπòÎ•º Î≥¥Ïä§ ÏúÑÏπòÎ°ú ÏßÄÏ†ï
                    enemy.x = boss.x;
                    enemy.y = boss.y;
                    enemies.push(enemy);
                }
                showBossPatternEffect(boss.x, boss.y, t('bossPatternSummon'));
                playSound('bossSummon');
            }
            return false;
        }
    }
};

// Ï†Å Ïä§ÌÇ¨ Ï†ïÏùò
// Ï†ÅÏùò ÌäπÏàò Îä•Î†•ÏùÑ Ï†ïÏùò
const ENEMY_SKILLS = {
    SHIELD: {
        name: t('enemySkillShield'),
        cooldown: 300, // 5Ï¥à
        effect: function (enemy) {
            enemy.isInvincible = true;
            enemy.shieldEffectTime = 120; // 2Ï¥à(60fps Í∏∞Ï§Ä)
            showSpecialEffect(enemy.x, enemy.y, t('enemySkillShield'));
            setTimeout(() => {
                if (!enemy.isDead) enemy.isInvincible = false;
            }, 2000);
        }
    },
    TELEPORT: {
        name: t('enemySkillTeleport'),
        cooldown: 400,
        effect: function (enemy) {
            if (enemy.pathIndex + 3 < currentMap.path.length - 1) {
                enemy.pathIndex += 3;
                const target = currentMap.path[enemy.pathIndex];
                enemy.x = target.x;
                enemy.y = target.y;
                showSkillEffect(enemy.x, enemy.y, t('enemySkillTeleport'));
                enemy.teleportEffectTime = 40; // 0.7Ï¥àÍ∞Ñ Ïù¥ÌéôÌä∏
            }
        }
    },
    HEAL_SELF: {
        name: t('enemySkillHealSelf'),
        cooldown: 350,
        effect: function (enemy) {
            const heal = Math.floor(enemy.maxHealth * 0.3);
            enemy.health = Math.min(enemy.maxHealth, enemy.health + heal);
            showSkillEffect(enemy.x, enemy.y, t('enemySkillHealSelf'));
            enemy.healEffectTime = 60; // 1Ï¥àÍ∞Ñ Ïù¥ÌéôÌä∏
        }
    },
    HEAL_AOE: {
        name: t('enemySkillHeal'),
        cooldown: 500,
        effect: function (enemy) {
            enemies.forEach(e => {
                if (e !== enemy && Math.abs(e.x - enemy.x) < 2 && Math.abs(e.y - enemy.y) < 2) {
                    e.health = Math.min(e.maxHealth, e.health + Math.floor(e.maxHealth * 0.2));
                    showSkillEffect(e.x, e.y, t('enemySkillHeal'));
                    e.healEffectTime = 60; // 1Ï¥àÍ∞Ñ Ïù¥ÌéôÌä∏
                }
            });
            showSkillEffect(enemy.x, enemy.y, t('enemySkillHeal'));
            enemy.healEffectTime = 60; // 1Ï¥àÍ∞Ñ Ïù¥ÌéôÌä∏
        }
    }
};

// ÏÉÅÌÉú Ìö®Í≥º Ï†ïÏùò
const STATUS_EFFECTS = {
    POISON: {
        name: 'ÎèÖ',
        duration: 180,
        damagePerTick: 2,
        color: '#00ff00',
        update: (enemy) => {
            if (enemy.isDead) return true;
            enemy.takeDamage(STATUS_EFFECTS.POISON.damagePerTick);
            return false;
        }
    },
    FROZEN: {
        name: 'ÎπôÍ≤∞',
        duration: 120,
        speedMultiplier: 0.5,
        color: '#00ffff',
        update: (enemy) => {
            if (enemy.isDead) return true;
            enemy.speed = enemy.baseSpeed * STATUS_EFFECTS.FROZEN.speedMultiplier;
            return false;
        }
    },
    BURNING: {
        name: 'ÌôîÏÉÅ',
        duration: 150,
        damagePerTick: 3,
        color: '#ff0000',
        update: (enemy) => {
            if (enemy.isDead) return true;
            enemy.takeDamage(STATUS_EFFECTS.BURNING.damagePerTick);
            return false;
        }
    }
};

// Ïù¥ÌéôÌä∏ ÌíÄ Í¥ÄÎ¶¨Ïûê
const EffectPool = {
    pools: new Map(),

    init(type, count = 10) {
        if (!this.pools.has(type)) {
            const pool = [];
            for (let i = 0; i < count; i++) {
                if (type === 'levelUp') {
                    pool.push({
                        active: false,
                        x: 0,
                        y: 0,
                        alpha: 1,
                        scale: 1,
                        rotation: 0,
                        type: 'levelUp',
                        duration: 1000,
                        startTime: 0,
                        draw: function () { },
                        update: function () { }
                    });
                } else {
                    const element = document.createElement('div');
                    element.className = type + '-effect';
                    element.style.display = 'none';
                    pool.push(element);
                }
            }
            this.pools.set(type, pool);
        }
    },

    get(type) {
        if (!this.pools.has(type)) {
            this.init(type);
        }
        const pool = this.pools.get(type);
        if (type === 'levelUp') {
            const effect = pool.find(e => !e.active);
            if (effect) {
                effect.active = true;
                return effect;
            }
            // ÌíÄÏù¥ ÎπÑÏñ¥ÏûàÏúºÎ©¥ ÏÉàÎ°ú ÏÉùÏÑ±
            const newEffect = {
                active: true,
                x: 0,
                y: 0,
                alpha: 1,
                scale: 1,
                rotation: 0,
                type: 'levelUp',
                duration: 1000,
                startTime: 0,
                draw: function () { },
                update: function () { }
            };
            pool.push(newEffect);
            return newEffect;
        } else {
            const element = pool.find(el => el.style.display === 'none');
            if (element) {
                return element;
            }
            // ÌíÄÏù¥ ÎπÑÏñ¥ÏûàÏúºÎ©¥ ÏÉàÎ°ú ÏÉùÏÑ±
            const newElement = document.createElement('div');
            newElement.className = type + '-effect';
            pool.push(newElement);
            return newElement;
        }
    },

    release(element) {
        if (element.type === 'levelUp') {
            element.active = false;
        } else {
            element.style.display = 'none';
            element.className = element.className.split(' ')[0]; // ÌÅ¥ÎûòÏä§ Ï¥àÍ∏∞Ìôî
            element.textContent = ''; // ÎÇ¥Ïö© Ï¥àÍ∏∞Ìôî
            element.style.cssText = ''; // Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî
        }
    },

    getPool(type) {
        return this.pools.get(type) || [];
    }
};

// ÌÉÄÏùº ÌïòÏù¥ÎùºÏù¥Ìä∏ Í¥ÄÎ†® Î≥ÄÏàòÎì§
let clickedTile = null;  // ÌÅ¥Î¶≠Ìïú ÌÉÄÏùº { x, y, timestamp }
let hoveredTile = null;  // Ìò∏Î≤ÑÌïú ÌÉÄÏùº { x, y }
let clickHighlightDuration = 3000; // ÌÅ¥Î¶≠ ÌïòÏù¥ÎùºÏù¥Ìä∏ ÏßÄÏÜç ÏãúÍ∞Ñ (ms)
